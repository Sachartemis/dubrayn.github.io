<!DOCTYPE html>
<html>
  <head>
    <title>IPS-DEV</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="core/fonts/mono.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/animate.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/cinescript.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/style_core.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/mermaid.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/gitgraph.css"> 
    <link rel="stylesheet" type="text/css" href="core/css/style_ensiie.css"> 
  </head>
  <body>
    <textarea id="source" readonly>

layout: true
class: animated fadeIn middle numbers

.footnote[
`IPS-DEV` - N. Dubray - ENSIIE - 2018 - [:arrow_left:](sumoptim.html) [:book:](../index.html) [:arrow_right:](valgrind.html)
]

---

# `git`: advanced uses

.hcenter.w15[![](images/git_logo.png)]

## Advanced uses

workflow : travailler sur un autre rÃ©seau

* git clone --depth=1 ... (recuperer une partie seulement de l'historique)
* git format-patch (creer patch)
* git apply (voir infos dans patch)
* git am (appliquer patch)

* git push -d (remove local or remote branch)
* git reset
* git blame
* git cherry-pick
* git archive
* git submodule
* git stash
* git remote
* git rebase vs. git merge
* git binary merge conflict
* git commit --amend (corriger un commit)
* git rebase --interactive HEAD~6 (corriger les 5 derniers commits)

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 1

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can occasionally connect networks `A` and `B`

]
## Example

:arrow_right: the repo for a **top-secret code** is on a company's intranet

:arrow_right: you want to work on the code on a company's laptop

:arrow_right: you can connect the laptop to the intranet when present at the company

:arrow_right: the code is allowed on the laptop or the intranet **only**

]
.column.middle.w40[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: LAN access
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: LAN access
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 1

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can occasionally connect networks `A` and `B`

]
## LAN solution

1. connect the laptop to the intranet
1. `git clone` on the laptop
1. disconnect the laptop
1. create commits on the laptop
1. connect the laptop to the intranet
1. `git push` on the laptop (possible merge conflict(s))

]
.column.middle.w40[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: git clone
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: git push
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

## LAN solution

1. connect the laptop to the intranet
1. `git clone` on the laptop
```shell
laptop> git clone ssh://gitrepos.intra.company.com/topsecret.git
```
1. disconnect the laptop
1. create commits on the laptop
```shell
laptop> git add ...
laptop> git commit -m "user can now order tacos"
laptop> git add ...
laptop> git commit -m "user can now order pizzas"
```
1. connect the laptop to the intranet
1. `git push` on the laptop (possible merge conflict(s))
```shell
laptop> git push
```

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 2

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can use **USB sticks** between networks `A` and `B` 
]

## Example

:arrow_right: the repo for a **top-secret code** is on a company's intranet

:arrow_right: you want to work on the code on a company's laptop

:arrow_right: you can not connect the laptop to the intranet

:arrow_right: you can transfer company's **USB sticks** between the intranet and the laptop

:arrow_right: the code is allowed on the laptop, the intranet or the USB sticks **only**

]
.column.middle.w40[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: USB copy
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: USB copy
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 2

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can use **USB sticks** between networks `A` and `B` 
]

## Possible issues with the LAN solution

* The repo may be **bigger than the USB stick capacity**

* `git clone` **may take forever** (slow IO + large repo)
]
.column.middle.w40[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: USB copy
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: USB copy
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 2

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can use **USB sticks** between networks `A` and `B` 
]

## Possible solution #1

1. copy **only the last version of the code** to the laptop
1. initialize a `git` repo on the laptop
1. create commits on the laptop
1. create a **patch** on the laptop
1. apply the patch to the repo
]
.column.middle.w40[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: .tgz
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: .patch
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

## Possible solution #1

1. copy **only the last version of the code** to the laptop ( :warning: does not work on `github.com`)
```shell
intranet> git archive --format=tar --remote=~/workspace/topsecret master | gzip - > /media/dubrayn/usbdisk/topsecret.tgz
intranet> eject /media/dubrayn/usbdisk
laptop> mkdir topsecret
laptop> cd topsecret
laptop> tar xvfz /media/dubrayn/usbstick/topsecret.tgz
```
1. initialize a `git` repo on the laptop
```shell
laptop> git init
laptop> git add -A
laptop> git commit -m "initial commit"
```
1. create commits on the laptop (in a new branch)
```shell
laptop> git checkout -b localwork
laptop> git add ...
laptop> git commit -m "user can now order tacos"
laptop> git add ...
laptop> git commit -m "user can now order pizzas"
```
1. create a **patch** on the laptop
```shell
laptop> git format-patch master --stdout > /media/dubrayn/usbdisk/toto.patch
laptop> eject /media/dubrayn/usbdisk
```
1. apply the patch to the repo
```shell
intranet> cd ~/workspace/topsecret
intranet> git am /media/dubrayn/usbdisk/toto.patch
```

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 2

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can use **USB sticks** between networks `A` and `B` 
]

## Possible solution #1

1. copy **only the last version of the code** to the laptop
1. initialize a `git` repo on the laptop
1. create commits on the laptop
1. create a **patch** on the laptop
1. apply the patch to the repo

## Possible issues

1. one has to remember which version was in the archive
1. one has no access to previous commits of the project
]
.column.w40.middle[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: .tgz
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: .patch
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 2

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can use **USB sticks** between networks `A` and `B` 
]

## Possible solution #2

1. **clone only the last commits** on the laptop
1. create commits on the laptop
1. create a **patch** on the laptop
1. apply the patch to the repo
]
.column.w40.middle[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: git clone --depth
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: .patch
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

## Possible solution #2

1. **clone only some recent versions of the code** on the laptop
```shell
intranet> git clone -b master --depth=5 file:///home/dubrayn/workspace/topsecret /media/dubrayn/usbdisk/topsecret
intranet> eject /media/dubrayn/usbdisk
laptop> cp -rf /media/dubrayn/usbstick/topsecret . && cd topsecret
```
1. create commits on the laptop (in a new branch)
```shell
laptop> git checkout -b localwork
laptop> git add ...
laptop> git commit -m "user can now order tacos"
laptop> git add ...
laptop> git commit -m "user can now order pizzas"
```
1. create a **patch** on the laptop
```shell
laptop> git format-patch master --stdout > /media/dubrayn/usbdisk/toto.patch
laptop> eject /media/dubrayn/usbdisk
```
1. apply the patch to the repo
```shell
intranet> cd ~/workspace/topsecret
intranet> git am /media/dubrayn/usbdisk/toto.patch
```

---

# Special `git` workflows

.row[
.column.w60[
.block[

## Offline `git` workflow 2

:arrow_right: the "official" repo is on network `A`

:arrow_right: you have to develop on network `B`

:arrow_right: you can use **USB sticks** between networks `A` and `B` 
]

## Possible solution #2

1. **clone only the last commits** on the laptop
1. create commits on the laptop
1. create a **patch** on the laptop
1. apply the patch to the repo

## Possible issues

:arrow_right: **NO ISSUES** :v:

]
.column.w40.middle[
.mermaid[
    sequenceDiagram
        Note over Intranet: Repo
        Intranet->>Laptop: git clone --depth
        Note over Intranet: Changes
        Note over Laptop: Changes
        Laptop->>Intranet: patches
        Note over Intranet: Updated repo
]
]
]

---

# Special `git` workflows

## `git apply`

:arrow_right: Use `--check` to see if a patch can be applied
```shell
$ git apply --check ../tutu.patch
error: new_file2: already exists in working directory
```

:arrow_right: Use `--stat` to see the `diffstat`
```shell
$ git apply --stat ../tutu.patch
 new_file1 |     0
 new_file2 |     0
 2 files changed, 0 insertions(+), 0 deletions(-)
```

    </textarea>

    <script src="core/javascript/remark.js"></script>
    <script src="core/javascript/plotly.js" type="text/javascript"></script>
    <script src="core/javascript/MathJax/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured" type="text/javascript"></script>
    <script src="core/javascript/emojify.js" type="text/javascript"></script>
    <script src="core/javascript/mermaid.js" type="text/javascript"></script>
    <script src="core/javascript/term.js" type="text/javascript"></script>
    <script src="core/javascript/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="core/javascript/extend-jquery.js" type="text/javascript"></script>
    <script src="core/javascript/cinescript.js" type="text/javascript"></script>
    <script src="core/javascript/gitgraph.js" type="text/javascript"></script>
    <script>

    // === Remark.js initialization ===
    var slideshow = remark.create({
      highlightStyle: 'monokai',
      countIncrementalSlides: false,
      highlightLines: true,
      highlightInlineCode: false
    });

    // === Mermaid.js initialization ===
    mermaid.initialize({
      startOnLoad: false,
      cloneCssStyles: false,
      flowchart:{
        height: 50
      },
      sequenceDiagram:{
        width: 110,
        height: 30
      }
    });

    function initMermaid(s) {
      var diagrams = document.querySelectorAll('.mermaid');
      var i;
      for(i=0;i<diagrams.length;i++){
        if(diagrams[i].offsetWidth>0){
          mermaid.init(undefined, diagrams[i]);
        }
      }
    }

    slideshow.on('afterShowSlide', initMermaid);
    initMermaid(slideshow.getSlides()[slideshow.getCurrentSlideIndex()]);

    // === MathJax.js initialization ===
    MathJax.Hub.Config({ tex2jax: { skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'] } }); 
    MathJax.Hub.Queue(function() { $(MathJax.Hub.getAllJax()).map(function(index, elem) { return(elem.SourceElement()); }).parent().addClass('has-jax'); });
    MathJax.Hub.Configured();

    // === Emojify.js initialization ===
    emojify.run();

    // === Cinescript initialization ===
    $(document).ready(init_cinescripts);

    </script>
    <script src="gitgraphs.js" type="text/javascript"></script>
  </body>
</html>

